<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil | JojoBy</title>
     <link rel="icon" href="./assets/image-Photoroom (6) 1.png">
    <link rel="stylesheet" href="./css/nav.css">
    <link rel="stylesheet" href="./css/perfil.css">
    <link rel="stylesheet" href="./css/fonts/fonte.css">
</head>

<body>
    <nav id="menu-nav" class="menu-nav">
        <div class="logo-nav-lateral">
            <div class="icon-nav">
                <img src="./assets/image 18.png" alt="">
                <h2>Olá, <span id="nome"></span> </h2>

                <ul>
                    <li>
                        <a href="dashboard.html">Centro de Dados</a>
                    </li>
                    <li>
                        <a href="quiz.html">Questionário</a>
                    </li>
                    <li>
                        <a href="personagem.html">Elenco Estelar</a>
                    </li>
                    <li>
                        <a href="perfil.html">Perfil</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="sair-nav">
            <p>Sair</p>
        </div>
    </nav>

    <section class="secao-perfil">
        <div class="titulo-alinhamento">
            <h1> Configurações Estelar</h1>
        </div>

        <div class="container-alteracao">
            <h2> Informações Básicas </h2>

            <div class="alteracao-informacao">
                <div class="campo-alterar">
                    <p class="titulo-alterar"> Nome de Usuário: </p>
                    <input type="text" id="input_nome" placeholder="Seu nome">
                </div>

                

                <div class="container-botao-alinhar"><div class="campo-alterar">
                    <p class="titulo-alterar"> E-mail:> </p>
                    <input type="email" id="input_email" placeholder="Seu E-mail">
                </div>
                    <button onclick="salvar()">Salvar Informações</button>
                </div>
            </div>
        </div>

        <section class="container-secao ">

            <div class="info-01">
                <div class="titulo-alinhamento">
                    <h1> Segurança </h1>
                </div>
                <div class="alteracao-informacao">
                    <div class="campo-alterar">
                        <p class="titulo-alterar"> Alterar Senha </p>
                        <input type="password" name="" id="input_senha" placeholder="Sua senha">
                    </div>

                    <div class="campo-alterar">
                        <p class="titulo-alterar"> Confirmar Senha </p>
                        <input type="password" name="" id="input_confirmarSenha" placeholder="Confirme sua senha">
                    </div>
                    <button onclick="salvar()" class="botao-seguranca">Salvar Alterações</button>
                    
                    
                </div>
            </div>

            <div class="info-01 personalizar">
                <div class="titulo-alinhamento">
                    <h1> Personalização </h1>
                </div>

                <div class="alteracao-informacao">
                    <div class="imagens-personalizar">
                        <img src="./assets/image 18.png" alt="">
                        <img src="./assets/image 18.png" alt="">
                        <img src="./assets/image 18.png" alt="">
                    </div>
                    
                </div>
                <button onclick="salvar()" class="botao-seguranca">Salvar Personalizacao</button>
            </div>

        </section>

        <section class="botoes-conta">
            <div class="info-01">
                <div class="titulo-alinhamento">
                    <h1> Seção de Conta </h1>
                </div>
                <div class="container-botoes">
                    <button class="desconectar-conta"> Desconectar Stand </button>
                    <button class="deletar-conta">Deletar Conta </button>
                </div>
            </div>
                <p>Seu destino pode mudar, mas seu Stand sempre te <br> acompanhará.</p>
        </section>
    </section>
</body>

</html>

<script>
    window.onload = () => {
        var usuarioID = sessionStorage.ID_USUARIO;
        fetch(`/perfil/exibir?id=${usuarioID}`)
            .then(res => res.json())
            .then(usuarioArray => {

                var usuario = usuarioArray[0]
                document.getElementById("nome").textContent = usuario.nome;
                document.getElementById("input_nome").textContent = usuario.nome;
                document.getElementById("input_email").textContent = usuario.email;
            })
            .catch(err => console.error("Erro ao carregar perfil: ", err));
    }

    function salvar() {
        var usuarioID = sessionStorage.ID_USUARIO;
        var nome = input_nome.value;
        var email = input_email.value;
        var senha = input_senha.value;
        var confirmarSenha = input_confirmarSenha.value;

        if (senha != confirmarSenha) {
            alert("As senhas precisam ser iguais.")
            return;
        }

        fetch("/perfil/atualizar", {
            method:"PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify ({
                id:usuarioID,
                nome: nome,
                email: email,
                senha: senha
            })
        })
        .then(res => res.json())
        .then(resp => {
            alert("Informações atualizadas com sucesso!");
        }) 
        .catch(err => console.error("Erro ao atualizar perfil: ", err));
    }
</script>